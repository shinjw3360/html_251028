<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="01_calcStyle.css">
</head>
<body>
    <div class="container">
        <h1 id="printResult">0</h1>
        <div class="area">
            <button type="button" value="7">7</button>
            <button type="button" value="8">8</button>
            <button type="button" value="9">9</button>
            <button type="button" value="+">+</button>

            <button type="button" value="4">4</button>
            <button type="button" value="5">5</button>
            <button type="button" value="6">6</button>
            <button type="button" value="-">-</button>

            <button type="button" value="1">1</button>
            <button type="button" value="2">2</button>
            <button type="button" value="3">3</button>
            <button type="button" value="*">*</button>

            <button type="button" value=".">.</button>
            <button type="button" value="0">0</button>
            <button type="button" value="=">=</button>
            <button type="button" value="/">/</button>

            <button type="button" value="c" class="c">C</button>
        </div>
    </div>
    <script src="01_calc.js"></script>
</body>
</html>

<script>
  //getElementByClassName => 배열로 리턴 [0]
  const container = document.querySelector('.container');
  console.log(container);
  const printResult = document.getElementById('printResult');
  let printValue = ''; // 최종 결과 string
  let isResultShow = false; // = 이후 결과가 표시된 상태인지를 추적
  
  container.addEventListener('click',(e)=>{
      console.log(e.target.value);
      let btnValue = e.target.value;
      
      // value가 없는 부분은 undefined 
      if(btnValue === undefined) return;
  
      // 숫자 isNaN => false
      console.log(isNaN(btnValue));
      if(!isNaN(btnValue)){
          // 계산 결과가 있는지 확인 변수
          if(isResultShow){
              // 결과 -> 새로운 계산시작
              printValue = btnValue;
              isResultShow = false;
          }else{
              // 결과X
              printValue += btnValue;
          }
      }else{
          // 숫자가 아닌 케이스 (+ - * / . = c)
          if(btnValue !== undefined){
              // 값이 비었을 경우 [] 안의 연산이 먼저 나오면 0으로 변경
              if(printValue == '' && ['+','-','*','/','.'].includes(btnValue)){
                  printValue = '0';
                  // return; 무시하려면 
              }
              switch(btnValue){
                  case'c': 
                      // 변수 / 화면 초기화
                      printValue='';
                      printResult.innerText = '0';
                      return;
                  
                  case'.': 
                  // 소수점 연속적 발생 방지
                      const parts = printValue.split(/[\+\-\*\/]/);
                      if(!parts.pop().includes('.')){
                          //기존 값에 붙이기
                          printValue += btnValue;
                      }
                  break;
                  default: 
                      let result = 0; // 연산의 결과를 받을 변수
                      
                      if(btnValue == '='){
                          // 계산하기
                          result = extractValue(printValue);
                          printValue = result;
                          isResultShow = true;
                      }else{
                          // + - * /  123 +  추가
                          // 연산자가 연속으로 두번 눌릴경우 
                          // 이전 연산자를 새 연산자로 교체
                          console.log(printValue);
                          
                          // 결과가 표시된 상태에서 연산자 -> 이어서 계산
                          if(isResultShow){
                              isResultShow = false;
                          }
                          
                          // 1. 마지막 문자가 연산자인지 확인
                          let trimmed = printValue.trim();
                          if(/[\+\-\*\/]$/.test(trimmed)){
                              // 2. 마지막 연산자를 새 연산자로 교체
                              printValue = trimmed.slice(0, -1) + btnValue + " " ;
                          }else{
                              // 일반적인 경우
                              printValue += ` ${btnValue} `;
                          }
                      }
                  break;
  
              }
          }
  
      }
  
      printResult.innerText = printValue;
  });
  
  function operation(f, o, l){
      // f, l 은 number 형태로 들어와야 함.
      f = Number(f);
      l = Number(l);
      let result = 0;
      switch(o){
          case '+': result = f + l; break;
          case '-': result = f - l; break;
          case '*': result = f * l; break;
          case '/': 
              if(l == 0){
                  alert('0으로 나눌 수 없습니다.');
                  return 0;
              }
              result = f / l;
          break;
          default: break;
      }
      return result.toFixed(2);
  }
  
  function extractValue(strVal){
      // strValue = 123 + 456
      // substring(시작번지, 끝번지)
      // substr(시작번지, 개수)
      let firstNum = strVal.substring(0, strVal.indexOf(" "));
      let lastNum = strVal.substring(strVal.lastIndexOf(" ")+1);
      let op = strVal.substr(strVal.indexOf(" ")+1,1);
      console.log(firstNum);
      console.log(op);
      console.log(lastNum);
      return operation(firstNum, op, lastNum);
  }

</script>

<style>
  .container{
      width: 300px;
      margin: 50px auto;
  }
  #printResult{
      text-align: right;
      padding: 15px;
      background-color: #f6dca8;
      border: 1px solid rgb(203, 155, 72);
      border-radius: 15px;
      font-size: 25px;
      height: 40px;
      margin-bottom: 10px;
  }
  .container>.area{
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
  }
  .container>.area>.c{
      grid-column: span 4;
      background-color: #f86b6b;
  }
  .container>.area>button{
      padding: 20px;
      font-size: 18px;
      border: none;
      cursor: pointer;
      border-radius: 15px;
      background-color: #edb0b0;
      box-shadow: 0px 4px 4px #f4e2e2;
  }
</style>
